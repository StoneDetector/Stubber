# Stubber : Bytecode Compilation without Dependencies for Java Code Clone Detection

Stubber is a tool to create compilable Java files from Java source code files without dependencies. The Stubber tool can make 95% of all Java files compilable in BigCloneBench. Thereby 92.5% of all clones are preserved. Of course, the Stubber tool can also be applied to other Java files.

# Prepared files for the BigCloneBench and the BigCloneEval
* First of all [BigCloneEval](https://github.com/jeffsvajlenko/BigCloneEval) must be installed
* The database must then be replaced with [this](https://drive.google.com/file/d/1c95ubC-UBCAU0rudj6_UWSaE926qPxq_/view?usp=sharing) database, in which all non-compilable files and clones have been removed
* The Java files in bcb_reduced must then be replaced with [these](https://drive.google.com/file/d/1-tjdLO3LUny1Kv6Nd1wHpiaXrK45_IPA/view?usp=sharing) files

# Identify Clones for BCB
Methods in clone pairs are identified by BigCloneEval using the subfolder and the Java source file they are located in, as well as their respective start and end line in the source file. Apparently, the line numbers of the files generated by the Stubber tool can not be used for that purpose. Instead, the tool offers a way for mapping the generated Java Bytecode methods back to the original Java source code methods. files.
The Stubber tool creates annotatations for the methods during compilation to Java Bytecode, containing the methods’ location information as required by BigCloneEval. Furthermore, the annotations can be used to distinguish between methods included in the original Java source files and methods which have been artifically introduced by the Stubber tool to enable Bytecode compilation. The definition of the used annotation interface is part of the StubClass subpackage included in the generated JAR files. The annotation is visible in Java Bytecode and can be programmatically accessed. For convenient usage, the Stubber tool includes a script (utils/ByteCodeInfos) which maps the methods in the Java Bytecode to the respective original methods in the Java source code. To this end, the script parses the annotations in the generated Bytecode class files and generates a CSV file [ByteCodeInfo.csv](https://drive.google.com/file/d/17WpHUHYJrY0c8HD3-53GJXe-hgpg_GZa/view?usp=sharing), in which for each method of the class file, the source code location information is stored. Additionally, the CSV file also contains information about the method name and the method’s reference in the Bytecode’s constant pool. The script can also be used as blueprint for accessing the annotations programmatically, e.g., when implementing a clone detector using Soot or Wala.

The CSV file is structured as follows. 
```
Path/To/Jar, Subfolder, Java_file_name, Start_line, End_line, Class_name_in_the_jar , Function_name , Address_of_the_name_in_the_constants_pool, Address_of_the_signature_in_the_constants_pool
```
Example:
```
2/default/137166.jar, default, 137166.java, 26, 28, _137166.Configuration.class, replace_localFunction1, 64, 65
```

When a clone pair is returned, the information in the ByteCodeInfo.csv can now simply be used. 
Example:
```
default,137166.java,26,28,default,137166.java,50,52,
```
Such an output can then be processed by BigCloneEval.

# More detailed instructions follow soon..
